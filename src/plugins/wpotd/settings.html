<span>If the date field is blank it will default to today's date. This is useful when adding to a playlist.</span>
<div class="form-group">
    <label for="customDate" class="form-label">Date (optional)</label>
    <input type="date" id="customDate" name="customDate" class="form-input" />
</div>
<div class="form-group">
    <label for="randomizeWpotd" class="form-label">Randomize date</label>
    <div class="toggle-container">
        <input type="checkbox" id="randomizeWpotd" name="randomizeWpotd" class="toggle-checkbox" value="false"
            onclick="this.value = this.checked ? 'true' : 'false'; toggleDateField(this)">
        <label for="randomizeWpotd" class="toggle-label"></label>
    </div>
</div>

<div class="form-group">
    <label for="shrinkToFitWpotd" class="form-label">Shrink the image to fit the display</label>
    <div class="toggle-container">
        <input type="checkbox" id="shrinkToFitWpotd" name="shrinkToFitWpotd" class="toggle-checkbox" value="true"
            onclick="this.value = this.checked ? 'true' : 'false';">
        <label for="shrinkToFitWpotd" class="toggle-label"></label>
    </div>
</div>

<div id="wpotdMeta" class="image-meta" style="display:none; margin-top:8px;">
    <div id="wpotdMetaContent"></div>
    <div style="font-size: 12px; color: #666; margin-top: 6px;">
        <em>Wikipedia requires attribution. Links provided above when available.</em>
    </div>
 </div>

<script>
    function toggleDateField(toggle) {
        const $date = document.getElementById('customDate');
        $date.disabled = toggle.checked;
    }

    document.addEventListener('DOMContentLoaded', () => {
        const $toggleRandom = document.getElementById('randomizeWpotd');
        const $date = document.getElementById('customDate');
        const $toggleShrink = document.getElementById('shrinkToFitWpotd');

        if (loadPluginSettings) {
            $toggleRandom.checked = pluginSettings.randomizeWpotd === 'true';
            $toggleRandom.value = pluginSettings.randomizeWpotd;
            $date.value = pluginSettings.customDate || "";
            $date.disabled = $toggleRandom.checked;
            $toggleShrink.checked = pluginSettings.shrinkToFitWpotd === 'true';
            $toggleShrink.value = pluginSettings.shrinkToFitWpotd;

        } else {
            $toggleRandom.checked = false;
            $toggleRandom.value = "false";
            $date.value = "";
            $toggleShrink.checked = true;
            $toggleShrink.value = "true";}

        // Try to populate WPOTD metadata panel from latest refresh
        try {
            fetch('{{ url_for('main.refresh_info') }}').then(r => r.json()).then(info => {
                const metaDiv = document.getElementById('wpotdMeta');
                const metaContent = document.getElementById('wpotdMetaContent');
                if (info && info.plugin_id === 'wpotd' && info.plugin_meta) {
                    const m = info.plugin_meta;
                    const date = m.date ? new Date(m.date).toISOString().slice(0,10) : '';
                    const caption = m.caption || '';
                    const link = m.description_url || m.page_url || '';
                    let html = '';
                    if (date) html += `<div><strong>Wikipedia Picture of the Day:</strong> ${date}</div>`;
                    if (caption) html += `<div style="margin-top:4px;">${caption}</div>`;
                    if (link) html += `<div style="margin-top:4px;"><a href="${link}" target="_blank" rel="noopener noreferrer">Learn more</a></div>`;
                    if (html) {
                        metaContent.innerHTML = html;
                        metaDiv.style.display = 'block';
                    }
                }
            }).catch(()=>{});
        } catch (e) {}
    });
</script>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Keys</title>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static',filename='styles/main.css') }}">
    <script src="{{ url_for('static', filename='scripts/response_modal.js') }}"></script>
    <script>
        async function saveKeys() {
            const form = document.getElementById('apiKeysForm');
            const data = new FormData(form);
            try {
                const resp = await fetch("{{ url_for('settings.save_api_keys') }}", { method: 'POST', body: data });
                const result = await resp.json();
                if (resp.ok) {
                    showResponseModal('success', `Success! ${result.message}`);
                } else {
                    showResponseModal('failure', `Error! ${result.error}`);
                }
            } catch (e) {
                alert('Failed to save keys.');
            }
        }

        async function deleteKey(keyName) {
            const data = new FormData();
            data.append('key', keyName);
            try {
                const resp = await fetch("{{ url_for('settings.delete_api_key') }}", { method: 'POST', body: data });
                const result = await resp.json();
                if (resp.ok) {
                    showResponseModal('success', `Success! ${result.message}`);
                } else {
                    showResponseModal('failure', `Error! ${result.error}`);
                }
            } catch (e) {
                alert('Failed to delete key.');
            }
        }
    </script>
</head>
<body>
    <div class="frame">
        <button onclick="history.back()" class="back-button">‚Üê Back</button>
        <div class="app-header">
            <div class="title-container">
                <img src="{{ url_for('static', filename='icons/settings.png') }}" alt="settings icon" class="app-icon">
                <h1 class="app-title">API Keys</h1>
            </div>
        </div>
        <div class="separator"></div>

        <form id="apiKeysForm" class="settings-form">
            <div class="settings-container">
                <div class="form-group">
                    <label class="form-label">OpenAI</label>
                    <div>Configured: {{ 'Yes (' ~ masked.OPEN_AI_SECRET ~ ')' if masked.OPEN_AI_SECRET else 'No' }}</div>
                    <input type="password" name="OPEN_AI_SECRET" placeholder="Enter new value (optional)" class="form-input" />
                    <button type="button" class="header-button" style="background-color: #E53935; color: #fff; margin-top: 8px;" onclick="deleteKey('OPEN_AI_SECRET')">Delete</button>
                </div>

                <div class="form-group">
                    <label class="form-label">OpenWeatherMap</label>
                    <div>Configured: {{ 'Yes (' ~ masked.OPEN_WEATHER_MAP_SECRET ~ ')' if masked.OPEN_WEATHER_MAP_SECRET else 'No' }}</div>
                    <input type="password" name="OPEN_WEATHER_MAP_SECRET" placeholder="Enter new value (optional)" class="form-input" />
                    <button type="button" class="header-button" style="background-color: #E53935; color: #fff; margin-top: 8px;" onclick="deleteKey('OPEN_WEATHER_MAP_SECRET')">Delete</button>
                </div>

                <div class="form-group">
                    <label class="form-label">NASA APOD</label>
                    <div>Configured: {{ 'Yes (' ~ masked.NASA_SECRET ~ ')' if masked.NASA_SECRET else 'No' }}</div>
                    <input type="password" name="NASA_SECRET" placeholder="Enter new value (optional)" class="form-input" />
                    <button type="button" class="header-button" style="background-color: #E53935; color: #fff; margin-top: 8px;" onclick="deleteKey('NASA_SECRET')">Delete</button>
                </div>

                <div class="form-group">
                    <label class="form-label">Unsplash</label>
                    <div>Configured: {{ 'Yes (' ~ masked.UNSPLASH_ACCESS_KEY ~ ')' if masked.UNSPLASH_ACCESS_KEY else 'No' }}</div>
                    <input type="password" name="UNSPLASH_ACCESS_KEY" placeholder="Enter new value (optional)" class="form-input" />
                    <button type="button" class="header-button" style="background-color: #E53935; color: #fff; margin-top: 8px;" onclick="deleteKey('UNSPLASH_ACCESS_KEY')">Delete</button>
                </div>
            </div>
        </form>

        <div class="buttons-container">
            <button type="button" onclick="saveKeys()" class="action-button">Save</button>
        </div>
    </div>
    {% include 'response_modal.html' %}
</body>
</html>



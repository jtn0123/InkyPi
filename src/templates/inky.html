<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ config.name }}</title>
</head>
<link rel= "stylesheet" type= "text/css" href= "{{ url_for('static',filename='styles/main.css') }}">
<body>
    <!-- Subtle frame container -->
    <div class="frame">
        <!-- Page Title -->
        <header class="header">
            <h1>{{ config.name }}</h1>
            <a href="{{ url_for('history.history_page') }}" class="settings-button">
                <img src="{{ url_for('static', filename='icons/playlist.png') }}" title="History" alt="history icon" class="icon-image">
            </a>
            <a href="{{ url_for('playlist.playlists') }}" class="settings-button">
                <img src="{{ url_for('static', filename='icons/display.png') }}" title="Playlists" alt="playlists icon" class="icon-image">
            </a>
            <a href="{{ url_for('settings.settings_page') }}" class="settings-button">
                <img src="{{ url_for('static', filename='icons/settings.png') }}" title="Settings" alt="settings icon" class="icon-image">
            </a>
        </header>

        <!-- Display the current image (auto-refreshing preview) -->
        {% set fit = (config.get('preview_size_mode') == 'fit') %}
        <div class="image-container {% if not fit %}native{% endif %}">
            <img id="previewImage" src="{{ url_for('main.preview_image') }}" alt="Current Image"
                 {% if not fit %}style="width: {{ config.resolution[0] }}px; height: {{ config.resolution[1] }}px;"{% endif %}>
        </div>

        <!-- Separator -->
        <div class="separator"></div>
        <h2 class="plugins-title">Plugins</h2>
        <div class="button-grid">
            {% for plugin in plugins %}
            <a href="{{ url_for('plugin.plugin_page', plugin_id=plugin.id) }}" class="icon-button" title="{{ plugin.display_name }}" >
                <img src="{{ url_for('plugin.image', plugin_id=plugin.id, filename='icon.png') }}" alt="{{ plugin.display_name }} icon" class="icon-image">
            </a>
            {% endfor %}
        </div>
    </div>
<script>
    // Periodically refresh the preview image by cache-busting the URL
    const previewImg = document.getElementById('previewImage');
    function refreshPreview(){
        const base = '{{ url_for('main.preview_image') }}';
        previewImg.src = base + '?t=' + Date.now();
    }
    // Refresh every 5 seconds
    setInterval(refreshPreview, 5000);

    // Click to toggle between fit and native resolution
    (function(){
        const container = previewImg && previewImg.parentElement;
        if (!previewImg || !container) return;
        const nativeWidth = {{ config.resolution[0] }};
        const nativeHeight = {{ config.resolution[1] }};
        previewImg.addEventListener('click', function(){
            if (container.classList.contains('native')) {
                container.classList.remove('native');
                previewImg.removeAttribute('style');
            } else {
                container.classList.add('native');
                previewImg.style.width = nativeWidth + 'px';
                previewImg.style.height = nativeHeight + 'px';
            }
        });
    })();
</script>
<body>
</html>

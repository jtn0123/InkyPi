<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Playlists</title>
    <link rel= "stylesheet" type= "text/css" href= "{{ url_for('static',filename='styles/main.css') }}">
    <script src="{{ url_for('static', filename='scripts/theme.js') }}" defer></script>
    <script src="{{ url_for('static', filename='scripts/response_modal.js') }}" defer></script>
    <script>
        window.PLAYLIST_CTX = {
            reorder_url: "{{ url_for('playlist.reorder_plugins') }}",
            delete_plugin_instance_url: "{{ url_for('plugin.delete_plugin_instance') }}",
            display_plugin_instance_url: "{{ url_for('plugin.display_plugin_instance') }}",
            create_playlist_url: "{{ url_for('playlist.create_playlist') }}",
            update_playlist_base_url: "{{ url_for('playlist.update_playlist', playlist_name='') }}",
            delete_playlist_base_url: "{{ url_for('playlist.delete_playlist', playlist_name='') }}",
            display_next_url: "{{ url_for('playlist.display_next_in_playlist') }}",
            device_tz_offset_min: {{ device_tz_offset_min | default(0) }}
        };
    </script>
    <script src="{{ url_for('static', filename='scripts/playlist.js') }}" defer></script>
    <script>
        /* Inline script disabled; logic moved to static/scripts/playlist.js */
        if (false) {
        // Drag-and-drop reordering support (desktop/basic)
        let dragSrcEl = null;
        function handleDragStart(e){
            dragSrcEl = this;
            e.dataTransfer.effectAllowed = 'move';
            e.dataTransfer.setData('text/plain', this.id);
            this.classList.add('dragging');
        }
        function handleDragOver(e){
            if (e.preventDefault) e.preventDefault();
            e.dataTransfer.dropEffect = 'move';
            return false;
        }
        function handleDrop(e){
            if (e.stopPropagation) e.stopPropagation();
            const srcId = e.dataTransfer.getData('text/plain');
            const srcEl = document.getElementById(srcId);
            if (srcEl && srcEl !== this){
                this.parentNode.insertBefore(srcEl, this.nextSibling);
                // After drop, persist new order for this playlist
                const container = this.closest('.playlist-item');
                const playlistName = container?.getAttribute('data-playlist-name');
                const ordered = Array.from(container.querySelectorAll('.plugin-item'))
                    .map(el => ({ plugin_id: el.getAttribute('data-plugin-id'), name: el.getAttribute('data-instance-name') }));
                if (playlistName && ordered.length){
                    fetch("{{ url_for('playlist.reorder_plugins') }}", {
                        method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ playlist_name: playlistName, ordered })
                    }).then(r => r.json()).then(j => {
                        if (!j.success){
                            showResponseModal('failure', `Error!  ${j.error || 'Failed to reorder'}`);
                        } else {
                            sessionStorage.setItem("storedMessage", JSON.stringify({ type: "success", text: `Success! ${j.message}` }));
                        }
                    }).catch(() => showResponseModal('failure', 'Error saving new order'));
                }
            }
            return false;
        }
        function handleDragEnd(){ this.classList.remove('dragging'); }

        function handleKeyReorder(e){
            if (e.key !== 'ArrowUp' && e.key !== 'ArrowDown') return;
            e.preventDefault();
            const item = e.currentTarget;
            const parent = item.parentElement;
            if (!parent) return;
            let target = (e.key === 'ArrowUp') ? item.previousElementSibling : item.nextElementSibling;
            while (target && !target.classList.contains('plugin-item')){
                target = (e.key === 'ArrowUp') ? target.previousElementSibling : target.nextElementSibling;
            }
            if (!target) return;
            if (e.key === 'ArrowUp') parent.insertBefore(item, target); else parent.insertBefore(item, target.nextSibling);
            const container = item.closest('.playlist-item');
            const playlistName = container?.getAttribute('data-playlist-name');
            const ordered = Array.from(container.querySelectorAll('.plugin-item'))
                .map(el => ({ plugin_id: el.getAttribute('data-plugin-id'), name: el.getAttribute('data-instance-name') }));
            if (playlistName && ordered.length){
                fetch("{{ url_for('playlist.reorder_plugins') }}", {
                    method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ playlist_name: playlistName, ordered })
                }).then(r => r.json()).then(j => {
                    if (!j.success){ showResponseModal('failure', `Error!  ${j.error || 'Failed to reorder'}`); }
                }).catch(() => showResponseModal('failure', 'Error saving new order'));
            }
            item.focus();
        }

        function enableDrag(container){}
        async function deletePluginInstance(){}

        async function displayPluginInstance(){}

        // Open modal for **creating** a new playlist
        function openCreateModal(){}

        // Open modal for **editing** an existing playlist
        function openEditModal(){}

        function openModal(){}
        function closeModal(){}

        async function createPlaylist(){}

        async function updatePlaylist(){}

        async function deletePlaylist(){}

        async function deletePlaylistQuick(name){
            openDeletePlaylistModal(name);
        }

        async function displayNextInPlaylist(name){
            try{
                const resp = await fetch("{{ url_for('playlist.display_next_in_playlist') }}", { method:'POST', headers: {'Content-Type':'application/json'}, body: JSON.stringify({ playlist_name: name }) });
                const j = await resp.json();
                if (!resp.ok || !j.success){
                    showResponseModal('failure', `Error!  ${j.error || 'Failed to display'}`);
                } else {
                    sessionStorage.setItem("storedMessage", JSON.stringify({ type: "success", text: `Success! ${j.message}` }));
                    setTimeout(() => { location.reload(); }, 500);
                }
            } catch(e){ showResponseModal('failure', 'Failed to trigger display'); }
        }

        function populateTimeOptions() {
            let startSelect = document.getElementById("start_time");
            let endSelect = document.getElementById("end_time");

            startSelect.innerHTML = "";
            endSelect.innerHTML = "";

            for (let hour = 0; hour < 24; hour++) { // 24-hour format (0-23)
                for (let minutes of [0, 15, 30, 45]) {
                    let time = hour.toString().padStart(2, '0') + ":" + minutes.toString().padStart(2, '0');
                    startSelect.innerHTML += `<option value="${time}">${time}</option>`;
                    endSelect.innerHTML += `<option value="${time}">${time}</option>`;
                }
            }
            startSelect.innerHTML += `<option value="24:00">24:00</option>`;
            endSelect.innerHTML += `<option value="24:00">24:00</option>`;
        }

        document.addEventListener("DOMContentLoaded", function(){
            populateTimeOptions();
            // Enable DnD for each playlist's plugin list
            document.querySelectorAll('.playlist-item .plugin-list').forEach(enableDrag);
            // Device frame overlay for thumbnails
            (function(){
                const toggle = document.getElementById('toggleDeviceFrameList');
                const list = document.querySelector('.playlist-list');
                if (!toggle || !list) return;
                const url = {{ url_for('plugin.image', plugin_id='base_plugin', filename='frames/device_frame.png') | tojson }};
                list.style.setProperty('--device-frame-url', `url('${url}')`);
                function update(){
                    if (toggle.checked) list.classList.add('device-frame-on'); else list.classList.remove('device-frame-on');
                }
                toggle.addEventListener('change', update); update();
            })();
            // Compute "Next in" countdowns client-side for interval-based instances
            try {
                const tzOffsetMin = {{ device_tz_offset_min | default(0) }};
                // Render device time continuously
                (function initDeviceClock(){
                    const val = document.getElementById('currentTimeValue');
                    if (!val) return;
                    function render(){
                        try {
                            const now = new Date();
                            const browserOffsetMin = -now.getTimezoneOffset();
                            const adjustMs = ({{ device_tz_offset_min | default(0) }} - browserOffsetMin) * 60000;
                            const devNow = new Date(now.getTime() + adjustMs);
                            val.textContent = devNow.toLocaleString(undefined, { hour12: false });
                        } catch(e) {}
                    }
                    setInterval(render, 1000);
                    render();
                })();
                function parseISO(s){ try { return s ? new Date(s) : null; } catch(e){ return null; } }
                function renderNextIn(){
                    document.querySelectorAll('.plugin-item').forEach(item => {
                        const name = item.getAttribute('data-instance-name');
                        const pluginId = item.getAttribute('data-plugin-id');
                        const infoEl = item.querySelector('.plugin-info');
                        if (!infoEl) return;
                        const intervalSecAttr = item.getAttribute('data-interval-sec');
                        const lastIsoAttr = item.getAttribute('data-latest-iso');
                        const nextEl = item.querySelector('[id^="nextIn_"]');
                        const nextAtEl = item.querySelector('[id^="nextAt_"]');
                        if (!nextEl && !nextAtEl) return;
                        const intervalSec = intervalSecAttr ? parseInt(intervalSecAttr, 10) : NaN;
                        if (!intervalSec || isNaN(intervalSec)) return;
                        const lastDate = parseISO(lastIsoAttr);
                        if (!lastDate) return;
                        const nextTs = lastDate.getTime() + (intervalSec * 1000);
                        const deltaMs = nextTs - Date.now();
                        if (nextEl){
                            if (deltaMs > 0){
                                const mins = Math.round(deltaMs / 60000);
                                if (mins < 60){
                                    nextEl.textContent = ` • Next in ${mins} min`;
                                } else {
                                    const hrs = Math.floor(mins / 60);
                                    const rem = mins % 60;
                                    nextEl.textContent = ` • Next in ${hrs}h ${rem}m`;
                                }
                            } else {
                                nextEl.textContent = '';
                            }
                        }
                        if (nextAtEl){
                            const browserOffsetMin = -new Date().getTimezoneOffset();
                            const deviceOffsetMin = {{ device_tz_offset_min | default(0) }};
                            const adjustMs = (deviceOffsetMin - browserOffsetMin) * 60000;
                            const deviceDate = new Date(nextTs + adjustMs);
                            const hh = String(deviceDate.getHours()).padStart(2,'0');
                            const mm = String(deviceDate.getMinutes()).padStart(2,'0');
                            nextAtEl.textContent = ` • Next at ${hh}:${mm}`;
                        }
                    });
                }
                setInterval(renderNextIn, 60000);
                renderNextIn();
            } catch(e) { /* ignore */ }
        });

        // snooze feature removed

        window.addEventListener("load", function () {
            let storedMessage = sessionStorage.getItem("storedMessage");
            if (storedMessage) {
                let { type, text } = JSON.parse(storedMessage);
                showResponseModal(type, text);
                sessionStorage.removeItem("storedMessage"); // Clear stored message after displaying
            }
        });

        // --- Delete confirm flows (replace confirm()) ---
        let _pendingDelete = null;
        function openDeletePlaylistModal(name){
            _pendingDelete = { type: 'playlist', name };
            document.getElementById('deletePlaylistText').textContent = `Delete playlist '${name}'?`;
            document.getElementById('deletePlaylistModal').style.display = 'block';
            const btn = document.getElementById('confirmDeletePlaylistBtn');
            btn.onclick = async function(){
                try {
                    const resp = await fetch("{{ url_for('playlist.delete_playlist', playlist_name='') }}" + name, { method: 'DELETE' });
                    const j = await resp.json();
                    if (!resp.ok){ showResponseModal('failure', `Error!  ${j.error}`); return; }
                    // Show undo snackbar (cannot truly undo server delete without archive; provide UX affordance)
                    showUndo(`Playlist '${name}' deleted.`);
                    setTimeout(() => location.reload(), 800);
                } catch(e){ showResponseModal('failure', 'Failed to delete playlist'); }
                closeDeletePlaylistModal();
            };
        }
        function closeDeletePlaylistModal(){ document.getElementById('deletePlaylistModal').style.display = 'none'; }

        function openDeleteInstanceModal(playlistName, pluginId, instanceName){
            _pendingDelete = { type: 'instance', playlistName, pluginId, instanceName };
            document.getElementById('deleteInstanceText').textContent = `Delete instance '${instanceName}'?`;
            document.getElementById('deleteInstanceModal').style.display = 'block';
            const btn = document.getElementById('confirmDeleteInstanceBtn');
            btn.onclick = async function(){
                try {
                    const resp = await fetch("{{ url_for('plugin.delete_plugin_instance') }}", { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ playlist_name: playlistName, plugin_id: pluginId, plugin_instance: instanceName }) });
                    const j = await resp.json();
                    if (!resp.ok){ showResponseModal('failure', `Error!  ${j.error}`); return; }
                    showUndo(`Instance '${instanceName}' deleted.`);
                    setTimeout(() => location.reload(), 800);
                } catch(e){ showResponseModal('failure', 'Failed to delete instance'); }
                closeDeleteInstanceModal();
            };
        }
        function closeDeleteInstanceModal(){ document.getElementById('deleteInstanceModal').style.display = 'none'; }

        function showUndo(text){
            const sb = document.getElementById('undoSnackbar');
            const txt = document.getElementById('undoText');
            txt.textContent = text + ' Undo?';
            sb.style.display = 'inline-flex';
            const undo = document.getElementById('undoBtn');
            undo.onclick = function(){ sb.style.display = 'none'; location.reload(); };
            setTimeout(() => { sb.style.display = 'none'; }, 4000);
        }
        }
    </script>
</head>
<body>
    <div class="frame">
        <!-- Back Button -->
        <button onclick="history.back()" class="back-button">← Back</button>
        <!-- Settings Header -->
        <div class="app-header">
            <div class="header-content">
                <div class="title-container">
                    {% from 'macros/icons.html' import icon %}
                    {{ icon('squares-four', 'app-icon') | safe }}
                    <h1 class="app-title">Playlists</h1>
                </div>
                <div style="margin-left:auto;display:flex;align-items:center;gap:12px;">
                    <button id="themeToggle" class="header-button icon" type="button" title="Toggle theme" aria-label="Toggle theme">
                        <svg class="theme-icon sun" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                            <circle cx="12" cy="12" r="5" stroke="currentColor"></circle>
                            <path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" stroke="currentColor"></path>
                        </svg>
                        <svg class="theme-icon moon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z" stroke="currentColor"></path>
                        </svg>
                    </button>
                    <label class="header-button is-dark" for="toggleDeviceFrameList" style="display:inline-flex;align-items:center;gap:6px;cursor:pointer;">
                        <input id="toggleDeviceFrameList" type="checkbox" aria-label="Show device frame in thumbnails" style="margin-right:6px;">Show device frame
                    </label>
                    <button class="header-button" onclick="openCreateModal()">New Playlist</button>
                </div>
            </div>
        </div>
        <div class="separator"></div>
        <div class="status-bar" style="margin-bottom:8px;">
            <div class="status-card">
                <div class="status-title">Current time</div>
                <div class="status-body"><span id="currentTimeValue">{{ device_now or '—' }}</span></div>
            </div>
            <div class="status-card">
                <div class="status-title">Device refresh cadence</div>
                <div class="status-body">Every {{ device_cycle_minutes }} min</div>
            </div>
        </div>

        {% set plugin_icon_map = {
            'ai_image': 'magic-wand',
            'ai_text': 'text-t',
            'weather': 'cloud-sun',
            'calendar': 'calendar-blank',
            'clock': 'clock',
            'newspaper': 'newspaper-clipping',
            'apod': 'planet',
            'unsplash': 'images-square',
            'image_url': 'link-simple',
            'image_upload': 'upload-simple',
            'image_folder': 'folder-simple',
            'screenshot': 'monitor',
            'wpotd': 'book-open-text',
            'comic': 'mask-happy'
        } %}

        <!-- Playlists Container -->
        <div class="playlist-list">
            {% for playlist in playlist_config.playlists %}
            <div class="playlist-item {% if playlist.name == playlist_config.active_playlist %}active{% endif %}" data-playlist-name="{{ playlist.name }}">
                    <div class="playlist-header">
                        <span class="playlist-title" title="Cycle: {{ (playlist_timing.get(playlist.name).cycle_minutes if (playlist_timing and playlist_timing.get(playlist.name)) else device_cycle_minutes) }} min{% if playlist_timing and playlist_timing.get(playlist.name) and playlist_timing.get(playlist.name).next_at %}\nNext at: {{ playlist_timing.get(playlist.name).next_at }}{% endif %}">{{ playlist.name }}</span>
                        <button class="edit-button" title="Edit playlist" aria-label="Edit playlist {{ playlist.name }}" onclick="openEditModal('{{ playlist.name }}', '{{ playlist.start_time }}','{{ playlist.end_time }}', '{{ (playlist.cycle_interval_seconds // 60) if playlist.cycle_interval_seconds is defined and playlist.cycle_interval_seconds is not none else '' }}')">{{ icon('gear-six', 'action-icon') }}</button>
                        <button class="header-button" title="Run next in this playlist" aria-label="Run next in playlist {{ playlist.name }}" onclick="displayNextInPlaylist('{{ playlist.name }}')">Run Next</button>
                        <button class="delete-button" title="Delete playlist" aria-label="Delete playlist {{ playlist.name }}" onclick="openDeletePlaylistModal('{{ playlist.name }}')">{{ icon('trash', 'action-icon') }}</button>
                    </div>
                    <!-- Plugin List -->
                    <div class="plugin-list">
                        {% for plugin_instance in playlist.plugins %}
                        <div class="plugin-item {% if playlist.name == refresh_info.playlist and plugin_instance.name == refresh_info.plugin_instance %}is-current{% endif %}" data-plugin-id="{{ plugin_instance.plugin_id }}" data-instance-name="{{ plugin_instance.name }}" {% if plugin_instance.refresh.interval is defined %}data-interval-sec="{{ plugin_instance.refresh.interval }}"{% endif %} {% if plugin_instance.latest_refresh_time %}data-latest-iso="{{ plugin_instance.latest_refresh_time }}"{% endif %}>
                            <div class="plugin-info" id="{{plugin_instance.name}}">
                                {% from 'macros/icons.html' import icon %}
                                {{ icon(plugin_icon_map.get(plugin_instance.plugin_id, 'images-square'), 'plugin-icon') | safe }}
                                <span class="plugin-instance">{{ plugin_instance.name }}</span>

                                <!-- Check if the current plugin is the one being displayed -->
                                {% if playlist.name == refresh_info.playlist and plugin_instance.name == refresh_info.plugin_instance %}
                                <span class="displayed-now">Displayed Now</span>
                                {% if metrics and metrics.request_ms is not none %}
                                <span class="latest-refresh" style="margin-left:8px;">
                                    {{ metrics.request_ms }} ms
                                </span>
                                {% endif %}
                                {% endif %}
                                <div id="loadingIndicator" class="loading-indicator small left-align"></div>

                            </div>
                            <div class="plugin-thumb" data-frame-style="{{ plugin_instance.plugin_settings.selectedFrame if plugin_instance.plugin_settings and plugin_instance.plugin_settings.selectedFrame else '' }}">
                                <div class="img-skeleton" aria-hidden="true"></div>
                                <img src="{{ url_for('plugin.plugin_instance_image', plugin_id=plugin_instance.plugin_id, instance_name=plugin_instance.name) }}" alt="Preview of {{ plugin_instance.name }}" width="120" height="90" loading="lazy" onload="this.previousElementSibling.style.display='none'" onerror="this.style.display='none'; this.previousElementSibling.style.display='none'">
                            </div>
                            <div class="plugin-actions">
                                <div class="timing-row">
                                    {% if plugin_instance.refresh.interval is defined %}
                                        {% if plugin_instance.latest_refresh_time %}
                                            {% set refresh_time = plugin_instance.latest_refresh_time | format_relative_time %}
                                            <span class="latest-refresh" title="{{plugin_instance.latest_refresh_time}}">Refreshed {{ refresh_time }}</span>
                                        {% else %}
                                            <span class="latest-refresh">Pending first run</span>
                                        {% endif %}
                                    {% elif plugin_instance.refresh.scheduled is defined %}
                                        <span class="latest-refresh">Scheduled {{ plugin_instance.refresh.scheduled }}</span>
                                    {% endif %}
                                    {% set eta = rotation_eta.get(playlist.name, {}).get(plugin_instance.name) if rotation_eta else None %}
                                    {% if eta %}
                                        {% set __h = (eta.minutes // 60) %}
                                        {% set __m = (eta.minutes % 60) %}
                                        <span class="latest-refresh">
                                            Next in
                                            {% if __h > 0 %} {{ __h }}h{% endif %}
                                            {% if __m > 0 %} {{ __m }}m{% endif %}
                                            • at {{ eta.at }}
                                        </span>
                                    {% endif %}
                                </div>

                                <a href="{{ url_for('plugin.plugin_page', plugin_id=plugin_instance.plugin_id) }}?instance={{ plugin_instance.name }}" class="btn" title="Edit" aria-label="Edit {{ plugin_instance.name }}"><span class="btn-label">Edit</span></a>
                                <button class="btn btn-primary plugin-display-btn" data-playlist="{{ playlist.name }}" data-plugin-id="{{ plugin_instance.plugin_id }}" data-instance="{{ plugin_instance.name }}" title="Display Now" aria-label="Display {{ plugin_instance.name }} now" onclick="displayPluginInstance('{{ playlist.name }}', '{{ plugin_instance.plugin_id }}','{{ plugin_instance.name }}', this)"><span class="btn-spinner" aria-hidden="true"></span><span class="btn-label">Display now</span></button>
                                <button class="btn btn-danger" title="Delete Plugin Instance" aria-label="Delete plugin instance {{ plugin_instance.name }}" onclick="openDeleteInstanceModal('{{ playlist.name }}','{{ plugin_instance.plugin_id }}','{{ plugin_instance.name }}')"><span class="btn-label">Delete</span></button>
                                
                            </div>
                        </div>
                        {% endfor %}
                    </div>
            </div>
            {% endfor %}
        </div>
    </div>

    <div id="globalProgress" class="progress-block" style="display:none;">
        <div class="progress-header">
            <span id="globalProgressText">Preparing…</span>
        </div>
        <div class="progress-bar"><div id="globalProgressBar" class="progress-fill" style="width: 10%;"></div></div>
    </div>

    <!-- Delete Confirmation Modal (Playlist) -->
    <div id="deletePlaylistModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="deletePlaylistTitle" style="display:none;">
        <div class="modal-content">
            <span class="close-button" onclick="closeDeletePlaylistModal()" aria-label="Close">×</span>
            <h2 id="deletePlaylistTitle">Delete Playlist</h2>
            <div class="separator"></div>
            <p id="deletePlaylistText">Are you sure you want to delete this playlist?</p>
            <div class="buttons-container" style="margin-top:12px;">
                <button type="button" class="action-button warn" id="confirmDeletePlaylistBtn">Delete</button>
                <button type="button" class="action-button" onclick="closeDeletePlaylistModal()">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal (Instance) -->
    <div id="deleteInstanceModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="deleteInstanceTitle" style="display:none;">
        <div class="modal-content">
            <span class="close-button" onclick="closeDeleteInstanceModal()" aria-label="Close">×</span>
            <h2 id="deleteInstanceTitle">Delete Instance</h2>
            <div class="separator"></div>
            <p id="deleteInstanceText">Are you sure you want to delete this instance?</p>
            <div class="buttons-container" style="margin-top:12px;">
                <button type="button" class="action-button warn" id="confirmDeleteInstanceBtn">Delete</button>
                <button type="button" class="action-button" onclick="closeDeleteInstanceModal()">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Undo Snackbar -->
    <div id="undoSnackbar" role="status" aria-live="polite">
      <span id="undoText">Deleted.</span>
      <button class="btn-link" id="undoBtn" aria-label="Undo delete">Undo</button>
    </div>

    <!-- Schedule Configuration Modal -->
    <div id="playlistModal" class="modal">
        <div class="modal-content">
            <span class="close-button" onclick="closeModal()">×</span>
            <h2 id="modalTitle">New Playlist</h2>
            <div class="separator"></div>
            <form id="scheduleForm" class="settings-form">
                <input type="hidden" id="editingPlaylistName" value="">  <!-- Track existing playlist -->

                <div class="form-group">
                    <label for="playlist_name" class="form-label">Playlist Name:</label>
                    <input type="text" id="playlist_name" name="playlist_name" placeholder="Type something..." required class="form-input">
                </div>
                <div class="form-group">
                    <label for="start_time" class="form-label">Display from </label>
                    <select id="start_time" name="start_time" class="form-input"></select>
                    <span> - </span>
                    <select id="end_time" name="end_time" class="form-input"></select>
                </div>
                <div class="form-group">
                    <label for="cycle_minutes" class="form-label">Advance every (minutes):</label>
                    <input type="number" id="cycle_minutes" name="cycle_minutes" class="form-input" min="0" placeholder="Leave empty to use device default">
                </div>
            </form>
            <div class="buttons-container">
                <button type="button" class="action-button" id="saveButton">Save</button>
                <button type="button" class="action-button warn hidden" id="deleteButton" onclick="deletePlaylist()">Delete</button>
            </div>
        </div>
    </div>

    <!-- Success/Error Modal -->
    {% include 'response_modal.html' %}
</body>
</html>
